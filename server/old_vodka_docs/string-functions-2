v2:~(|begin ~(_bind @bold &" nex"(|~(_bind @style-list ~(_parse-style ~(_get-style-from @nex_)_)_) ~(_bind @new-style-list ~(_set-style $"font-weight" $"bold" @style-list_)_) ~(_apply-style-to ~(_join-style @new-style-list_) @nex_)|)_) ~(_bind @italic &" nex"(|~(_bind @stylestring ~(_get-style-from @nex_)_) ~(_bind @newstylestring ~(_add-style $"font-style" $"italic" @stylestring_)_) ~(_apply-style-to @newstylestring @nex_)|)_) ~(_bind @parse-style &" stylestring"(|~(_bind @stylelist ~(_string-split @stylestring $";"_)_) ~(_bind @split-pairs &" lst"(|~(|if ~(_is-empty @lst_) [word](__) ~(|begin ~(_bind @pair ~(_string-split ~(_car @lst_) $":"_)_) ~(|cons @pair ~(_split-pairs ~(_cdr @lst_)_)|)|)|)|)_) ~(_split-pairs @stylelist_)|)_) ~(_bind @join-style &" stylelist"(|~(|if ~(_is-empty @stylelist_) $ ~(|begin ~(_bind @pair ~(_car @stylelist_)_) ~(_bind @pairstring ~(|string-cat ~(_car @pair_) ~(_car ~(_cdr @pair_)_)|)_) ~(|string-cat @pairstring ~(|join-style ~(_cdr @stylelist_)|)|)|)|)|)_) ~(_bind @add-style &" stylename styleval stylelist"(|~(|if ~(_has-style @stylename @stylelist_) @str ~(_string-cat @stylename $":" @styleval ~(_if ~(_string-eq @str $_) $ $";"_) @str_)|)|)_) ~(_bind @remove-style &" stylename stylelist"(||)_) ~(_bind @has-style &" stylename stylelist"(|~(|if ~(_is-empty @stylelist_) !no ~(|begin ~(_bind @style ~(_car @stylelist_)_) ~(_bind @pair ~(_string-split @style $":"_)_) ~(_bind @name ~(_car @pair_)_) ~(|if ~(_string-eq @stylename @name_) !yes ~(_has-style @stylename ~(_cdr @stylelist_)_)|)|)|)|)_) ~(_bind @string-substr &" str start len pos"(|~(|if ~(_::eq:: @pos ~(_::pl:: @start @len_)_) $ ~(|if ~(_::gte:: @pos @start_) ~(|string-cat ~(_string-char-at @str @pos_) ~(_string-substr @str @start @len ~(_::pl:: @pos #1_)_)|) ~(_string-substr @str @start @len ~(_::pl:: @pos #1_)_)|)|)|)_) ~(_bind @string-split &" str on"(|~(|begin ~(_bind @first-index-of ~(_string-index-of @str @on_)_) ~(|if ~(_is-error @first-index-of_) ~(_if ~(_string-eq @str $_) [word](__) ~(_cons @str [word](__)_)_) ~(|cons ~(|string-substr @str #0 @first-index-of #0|) ~(|string-split ~(|string-substr @str ~(_::pl:: @first-index-of #1_) ~(_- ~(_string-length @str_) ~(_::pl:: @first-index-of #1_)_) #0|) @on|)|)|)|)|)_)|)