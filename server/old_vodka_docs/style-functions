v2:~(|package @style ~(_import @util-functions_) ~(_bind @with-clip-percent &" nex top% right% bottom% left%"(|~(|with-style-set-to @nex $"clip-path" ~(|string-cat $"inset(" ~(_to-string ~(_round ~(_::ti:: %100 @top_)_)_) $"% " ~(_to-string ~(_round ~(_::ti:: %100 @right_)_)_) $"% " ~(_to-string ~(_round ~(_::ti:: %100 @bottom_)_)_) $"% " ~(_to-string ~(_round ~(_::ti:: %100 @left_)_)_) $"%)"|)|)|)_) ~(_bind @with-hidden &" nex"(|~(_with-style-set-to @nex $"visibility" $"hidden"_)|)_) ~(_bind @with-visible &" nex"(|~(_with-style-set-to @nex $"visibility" $"visible"_)|)_) ~(_bind @with-line-height &" nex val$"(|~(_with-style-set-to @nex $"line-height" @val_)|)_) ~(_bind @with-translate-x-y &" nex xpix#% ypix#%"(|~(_with-style-set-to @nex $"transform" ~(_string-cat $"translate(" ~(_to-string @xpix_) $"px," ~(_to-string @ypix_) $"px)"_)_)|)_) ~(_bind @with-stretch-x &" nex xstretch%"(|[doc](|[line](_[word](_[letter]"S" [letter]"t" [letter]"r" [letter]"e" [letter]"t" [letter]"c" [letter]"h" [letter]"e" [letter]"s"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"e"_) [separator]" " [word](_[letter]"n" [letter]"e" [letter]"x"_) [separator]" " [word](_[letter]"o" [letter]"u" [letter]"t"_) [separator]" " [word](_[letter]"a" [letter]"l" [letter]"o" [letter]"n" [letter]"g"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"e"_) [separator]" " [word](_[letter]"x"_) [separator]" " [word](_[letter]"a" [letter]"x" [letter]"i" [letter]"s"_) [separator]" " [word](_[letter]"a" [letter]"n" [letter]"d"_) [separator]" " [word](_[letter]"a" [letter]"d" [letter]"d" [letter]"s"_) [separator]" " [word](_[letter]"m" [letter]"a" [letter]"r" [letter]"g" [letter]"i" [letter]"n" [letter]"s"_) [separator]" " [word](_[letter]"s" [letter]"o"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"a" [letter]"t"_) [separator]" " [word](_[letter]"i" [letter]"t"_) [separator]" " [word](_[letter]"w" [letter]"i" [letter]"l" [letter]"l"_) [separator]" " [word](_[letter]"s" [letter]"t" [letter]"i" [letter]"l" [letter]"l"_) [separator]" " [word](_[letter]"f" [letter]"l" [letter]"o" [letter]"w"_)_) [line](_[word](_[letter]"c" [letter]"o" [letter]"r" [letter]"r" [letter]"e" [letter]"c" [letter]"t" [letter]"l" [letter]"y"_) [separator]" " [word](_[letter]"i" [letter]"n"_) [separator]" " [word](_[letter]"l" [letter]"i" [letter]"n" [letter]"e"_) [separator]" " [word](_[letter]"w" [letter]"i" [letter]"t" [letter]"h"_) [separator]" " [word](_[letter]"o" [letter]"t" [letter]"h" [letter]"e" [letter]"r"_) [separator]" " [word](_[letter]"t" [letter]"e" [letter]"x" [letter]"t"_) [separator]"."_)|) ~(_let @get-required-right-margin &" nex"(|~(_let @original-width ~(_get-pixel-width @nex_)_) ~(_let @required-right-margin ~(_- ~(_::ti:: @original-width @xstretch_) @original-width_)_) @required-right-margin|)_) ~(_let @set-style-for-nex &" nex"(|~(|with-style-set-to ~(|with-style-set-to ~(_with-style-set-to @nex $"transform" ~(_string-cat $"scale(" ~(_to-string @xstretch_) $", 1)"_)_) $"transform-origin" $"top left"|) $"margin-right" ~(_string-cat ~(_to-string ~(_get-required-right-margin @nex_)_) $"em"_)|)|)_) ~(_ff-with ~(_set-contents-changed ~(_cons @nex *(__)_)_) &" n"(|~(_set-style-for-nex @n_)|)_) ~(_set-style-for-nex @nex_)|)_) ~(_bind @with-stretch-y &" nex ystretch%"(|[doc](|[line](_[word](_[letter]"S" [letter]"t" [letter]"r" [letter]"e" [letter]"t" [letter]"c" [letter]"h" [letter]"e" [letter]"s"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"e"_) [separator]" " [word](_[letter]"n" [letter]"e" [letter]"x"_) [separator]" " [word](_[letter]"o" [letter]"u" [letter]"t"_) [separator]" " [word](_[letter]"a" [letter]"l" [letter]"o" [letter]"n" [letter]"g"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"e"_) [separator]" " [word](_[letter]"y"_) [separator]" " [word](_[letter]"a" [letter]"x" [letter]"i" [letter]"s"_) [separator]" " [word](_[letter]"a" [letter]"n" [letter]"d"_) [separator]" " [word](_[letter]"a" [letter]"d" [letter]"d" [letter]"s"_) [separator]" " [word](_[letter]"m" [letter]"a" [letter]"r" [letter]"g" [letter]"i" [letter]"n" [letter]"s"_) [separator]" " [word](_[letter]"s" [letter]"o"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"a" [letter]"t"_) [separator]" " [word](_[letter]"i" [letter]"t"_) [separator]" " [word](_[letter]"w" [letter]"i" [letter]"l" [letter]"l"_) [separator]" " [word](_[letter]"s" [letter]"t" [letter]"i" [letter]"l" [letter]"l"_) [separator]" " [word](_[letter]"f" [letter]"l" [letter]"o" [letter]"w"_)_) [line](_[word](_[letter]"c" [letter]"o" [letter]"r" [letter]"r" [letter]"e" [letter]"c" [letter]"t" [letter]"l" [letter]"y"_) [separator]" " [word](_[letter]"i" [letter]"n"_) [separator]" " [word](_[letter]"l" [letter]"i" [letter]"n" [letter]"e"_) [separator]" " [word](_[letter]"w" [letter]"i" [letter]"t" [letter]"h"_) [separator]" " [word](_[letter]"o" [letter]"t" [letter]"h" [letter]"e" [letter]"r"_) [separator]" " [word](_[letter]"t" [letter]"e" [letter]"x" [letter]"t"_) [separator]"."_)|) ~(_let @margin-em ~(_- @ystretch %1_)_) ~(|with-style-set-to ~(|with-style-set-to ~(_with-style-set-to @nex $"transform" ~(_string-cat $"scale(1, " ~(_to-string @ystretch_) $")"_)_) $"margin-top" ~(_string-cat ~(_to-string @margin-em_) $"em"_)|) $"margin-bottom" ~(_string-cat ~(_to-string @margin-em_) $"em"_)|)|)_) ~(_bind @align-right &" nex"(|~(_with-style-set-to @nex $"align-items" $"flex-end"_)|)_) ~(_bind @align-left &" nex"(|~(_with-style-set-to @nex $"align-items" $"flex-start"_)|)_) ~(_bind @align-center &" nex"(|~(_with-style-set-to @nex $"align-center" $"flex-start"_)|)_) ~(_bind @push-center &" nex"(|~(_with-style-set-to @nex $"justify-content" $"center"_)|)_) ~(_bind @push-left &" nex"(|~(_with-style-set-to @nex $"justify-content" $"left"_)|)_) ~(_bind @push-right &" nex"(|~(_with-style-set-to @nex $"justify-content" $"right"_)|)_) ~(_bind @clips-contents &" nex"(|~(_with-style-set-to @nex $"overflow" $"hidden"_)|)_) ~(_bind @with-scrollbars-on &" nex"(|~(_with-style-set-to @nex $"overflow" $"scroll"_)|)_) ~(_bind @with-x-offset-of &" nex val#%"(|~(|with-style-set-to ~(_with-style-set-to @nex $"position" $"relative"_) $"left" ~(_string-cat ~(_to-string @val_) $"px"_)|)|)_) ~(_bind @with-y-offset-of &" nex val#%"(|~(|with-style-set-to ~(_with-style-set-to @nex $"position" $"relative"_) $"top" ~(_string-cat ~(_to-string @val_) $"px"_)|)|)_) ~(_bind @with-alpha-of &" nex val%"(|~(_with-style-set-to @nex $"opacity" ~(_to-string @val_)_)|)_) ~(_bind @with-padding-of &" nex val#%"(|[line](_[word](_[letter]"S" [letter]"u" [letter]"r" [letter]"r" [letter]"o" [letter]"u" [letter]"n" [letter]"d" [letter]"s"_) [separator]" " [word](_[letter]"n" [letter]"e" [letter]"x"_) [separator]" " [word](_[letter]"w" [letter]"i" [letter]"t" [letter]"h"_) [separator]" " [word](_[letter]"p" [letter]"a" [letter]"d" [letter]"d" [letter]"i" [letter]"n" [letter]"g"_) [separator]" " [word](_[letter]"o" [letter]"f"_) [separator]" " [word](_[letter]"v" [letter]"a" [letter]"l"_) [separator]" " [word](_[letter]"o" [letter]"n"_) [separator]" " [word](_[letter]"a" [letter]"l" [letter]"l"_) [separator]" " [word](_[letter]"s" [letter]"i" [letter]"d" [letter]"e" [letter]"s"_) [separator]"."_) ~(_with-trlb-padding-of @nex @val @val @val @val_)|)_) ~(_bind @with-bottom-padding-of &" nex val#%"(|~(_with-style-set-to @nex $"padding-bottom" ~(_string-cat ~(_to-string @val_) $"px"_)_)|)_) ~(_bind @with-top-padding-of &" nex val#%"(|~(_with-style-set-to @nex $"padding-top" ~(_string-cat ~(_to-string @val_) $"px"_)_)|)_) ~(_bind @with-left-padding-of &" nex val#%"(|~(_with-style-set-to @nex $"padding-left" ~(_string-cat ~(_to-string @val_) $"px"_)_)|)_) ~(_bind @with-right-padding-of &" nex val#%"(|~(_with-style-set-to @nex $"padding-right" ~(_string-cat ~(_to-string @val_) $"px"_)_)|)_) ~(_bind @with-trlb-padding-of &" nex t#% r#% b#% l#%"(|~(|with-left-padding-of ~(|with-right-padding-of ~(|with-top-padding-of ~(|with-bottom-padding-of @nex @b|) @t|) @r|) @l|)|)_) ~(_bind @with-background-color-of &" nex color$"(|~(_with-style-set-to @nex $"background-color" @color_)|)_) ~(_bind @with-height-of &" nex height#%"(|~(_with-style-set-to @nex $"height" ~(_string-cat ~(_to-string @height_) $"px"_)_)|)_) ~(_bind @with-width-of &" nex width#%"(|~(_with-style-set-to @nex $"width" ~(_string-cat ~(_to-string @width_) $"px"_)_)|)_) ~(_bind @with-scale &" nex scale%"(|~(_with-style-set-to @nex $"transform" ~(_string-cat $"scale(" ~(_to-string @scale_) $"," ~(_to-string @scale_) $")"_)_)|)_) ~(_bind @with-transform-origin-x-y &" nex xorigin% yorigin%"(|~(_with-style-set-to @nex $"transform-origin" ~(|string-cat ~(_to-string @xorigin_) $"%" $" " ~(_to-string @yorigin_) $"%"|)_)|)_) ~(_bind @flipped-horizontally &" nex"(|~(_use @util_) ~(_let @stylestring ~(_get-value-for-style @nex $"transform"_)_) ~(_set @stylestring ~(_if ~(_is-nil @stylestring_) $"scale(1,1)" @stylestring_)_) ~(_let @xform ~(_string-split-on @stylestring $","_)_) ~(_let @horizhalf ~(_car @xform_)_) ~(_let @verthalf ~(_cadr @xform_)_) ~(_let @newstyle ~(|string-cat ~(_if ~(_equal @horizhalf $"scale(1"_) $"scale(-1" $"scale(1"_) $"," @verthalf|)_) ~(_with-style-set-to @nex $"transform" @newstyle_)|)_) ~(_bind @flipped-vertically &" nex"(|~(_use @util_) ~(_let @stylestring ~(_get-value-for-style @nex $"transform"_)_) ~(_set @stylestring ~(_if ~(_is-nil @stylestring_) $"scale(1,1)" @stylestring_)_) ~(_let @xform ~(_split-on @stylestring $","_)_) ~(_let @horizhalf ~(_car @xform_)_) ~(_let @verthalf ~(_cadr @xform_)_) ~(_let @newstyle ~(|string-cat @horizhalf $"," ~(_if ~(_equal @verthalf $"1)"_) $"-1)" $"1)"_)|)_) ~(_with-style-set-to @nex $"transform" @newstyle_)|)_) ~(_bind @rotate-by &" nex by%"(|~(_with-style-set-to @nex $"transform" ~(_string-cat $"rotate(" ~(_to-string @by_) $"deg)"_)_)|)_) ~(_bind @italicized &" nex"(|~(_with-style-set-to @nex $"font-style" $"italic"_)|)_) ~(_bind @bolded &" nex"(|~(_with-style-set-to @nex $"font-weight" $"bold"_)|)_) ~(_bind @with-light-weight &" nex"(|~(_with-style-set-to @nex $"font-weight" $"lighter"_)|)_) ~(_bind @with-normal-weight &" nex"(|~(_with-style-set-to @nex $"font-weight" $"normal"_)|)_) ~(_bind @normal &" nex"(|~(_with-style-set-to ~(_with-style-set-to @nex $"font-style" $"italic"_) $"font-weight" $"normal"_)|)_) ~(_bind @with-text-in-color &" nex color$"(|~(_with-style-set-to @nex $"color" @color_)|)_) ~(_bind @with-text-in-size &" nex size#%"(|~(_with-style-set-to @nex $"font-size" ~(_string-cat ~(_to-string @size_) $"px"_)_)|)_) ~(_bind @with-font &" nex fontname$"(|~(_with-style-set-to @nex $"font-family" @fontname_)|)_) ~(_bind @lowercased &" nex"(|~(_with-style-set-to @nex $"text-transform" $"lowercase"_)|)_) ~(_bind @uppercased &" nex"(|~(_with-style-set-to @nex $"text-transform" $"uppercase"_)|)_) ~(_bind @get-value-for-style &" nex stylename$"(|[doc](|[line](_[word](_[letter]"R" [letter]"e" [letter]"t" [letter]"u" [letter]"r" [letter]"n" [letter]"s"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"e"_) [separator]" " [word](_[letter]"v" [letter]"a" [letter]"l" [letter]"u" [letter]"e"_) [separator]" " [word](_[letter]"f" [letter]"o" [letter]"r"_) [separator]" " [word](_[letter]"a"_) [separator]" " [word](_[letter]"g" [letter]"i" [letter]"v" [letter]"e" [letter]"n"_) [separator]" " [word](_[letter]"s" [letter]"t" [letter]"y" [letter]"l" [letter]"e"_) [separator]" " [word](_[letter]"n" [letter]"a" [letter]"m" [letter]"e"_) [separator]"."_) [line](_[word](_[letter]"R" [letter]"e" [letter]"t" [letter]"u" [letter]"r" [letter]"n" [letter]"s"_) [separator]" " [word](_[letter]"n" [letter]"u" [letter]"l" [letter]"l"_) [separator]" " [word](_[letter]"i" [letter]"f"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"a" [letter]"t"_) [separator]" " [word](_[letter]"n" [letter]"e" [letter]"x"_) [separator]" " [word](_[letter]"d" [letter]"o" [letter]"e" [letter]"s" [letter]"n" [letter]"'" [letter]"t"_) [separator]" " [word](_[letter]"h" [letter]"a" [letter]"v" [letter]"e"_) [separator]" " [word](_[letter]"t" [letter]"h" [letter]"a" [letter]"t"_) [separator]" " [word](_[letter]"s" [letter]"t" [letter]"y" [letter]"l" [letter]"e"_) [separator]" " [word](_[letter]"s" [letter]"e" [letter]"t"_) [separator]"."_)|) ~(_let @styletable ~(_parse-style-string ~(_get-css-style-from @nex_)_)_) ~(_lookup-key-in @stylename @styletable_)|)_) ~(_bind @with-style-set-to &" nex stylename$ styleval$"(|~(_let @styletable ~(_parse-style-string ~(_get-css-style-from @nex_)_)_) ~(_let @newstyletable ~(_add-style-key-value-to @stylename @styleval @styletable_)_) ~(_apply-css-style-to ~(_to-style-string @newstyletable_) @nex_)|)_) ~(_bind @add-style-key-value-to &" stylename$ styleval$ stylelist()"(|~(_use @util_) ~(_add-key-value-to @stylename @styleval ~(_remove-all-entries-with-key-from @stylename @stylelist_)_)|)_) ~(_bind @parse-style-string &"() stylestring$"(|~(_map-with ~(|filter-with ~(_string-split-on @stylestring $";"_) &" str"(|~(_not ~(_equal @str $_)_)|)|) &" item"(|~(_string-split-on @item $":"_)|)_)|)_) ~(_bind @to-style-string &"$ stylemap()"(|~(_string-join-on ~(_map-with @stylemap &" item"(|~(_string-join-on @item $":"_)|)_) $";"_)|)_) ~(_bind @with-same-style-as &" dst src"(|~(_apply-css-style-to ~(_get-css-style-from @src_) @dst_)|)_)|)