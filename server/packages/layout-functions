v2:~(|package @layout ~(_import @traversal-functions_) ~(_import @list-functions_) ~(_import @style-functions_) ~(_bind @scale-to-pixel-width &" n width"(|~(_let @defaultsize #50_) ~(_let @infont ~"style:set-font-size-for to"(_@n @defaultsize_)_) ~(_let @widthindefaultfont ~(_get-pixel-width @infont_)_) ~(_let @heightindefaultfont ~(_get-pixel-height @infont_)_) ~(_let @ratio ~(_::ov:: ~(_to-float @width_) ~(_to-float @widthindefaultfont_)_)_) ~(_let @containerheight ~(_::ti:: @ratio ~(_to-float @heightindefaultfont_)_)_) ~(|cons ~"style:set-transform-origin-for to-x and-y"(_~"style:set-scale-for to"(_@infont @ratio_) %0.0 %0.0_) ~"style:set-height-for to"(_[line](__) @containerheight_)|)|)_) ~(_bind @justify-doc-to-width-in-format-by-line &" doc sizelimit format"(|~(|map-with @doc &" line"(|~(_let @formattedline ~(_format @line_)_) ~(_let @widthat50 ~(_get-pixel-width ~"style:set-font-size-for to"(_@formattedline #50_)_)_) ~(_let @desiredpixelsize ~(_to-integer ~(_::ti:: %50 ~(_::ov:: ~(_to-float @sizelimit_) @widthat50_)_)_)_) ~"style:set-font-size-for to"(_@formattedline @desiredpixelsize_)|)|)|)_) ~(_bind @justify-doc-to-width-in-format &" doc sizelimit format"(|~"map with"(|@doc &" line"(|~(_let @formattedline ~(_do-for-each-letter-or-separator-in &" letter"(|~(_format @letter_)|) @line_)_) ~(_let @widthat50 ~(_get-pixel-width ~"style:set-font-size-for to"(_@formattedline #50_)_)_) ~(_let @desiredpixelsize ~(_to-integer ~(_::ti:: %50 ~(_::ov:: ~(_to-float @sizelimit_) @widthat50_)_)_)_) ~(_do-for-each-letter-or-separator-in &" letter"(|~"style:set-font-size-for to"(|@letter @desiredpixelsize|)|) @formattedline_)|)|)|)_) ~(_bind @doc-with-contents-of &" lst"(|~(_list:concatenate-lists @lst [doc](||)_)|)_) ~(_bind @with-only-words &" lst"(|~"traversal:keep only-when"(_@lst @is-word_)|)_) ~(_bind @combine-lines &" doc"(|~(|if ~(_is-empty @doc_) [line](__) ~(_list:concatenate-lists ~(_car @doc_) ~(_combine-lines ~(_cdr @doc_)_)_)|)|)_) ~(_bind @flatten-lines &" doc"(|~(|map @doc &" line"(|~(_list:concatenate-lists ~(_list:flatten @line_) [line](__)_)|)|)|)_) ~(_bind @do-for-each-line-in &" f doc"(|~"traversal:in when do"(|@doc &" n"(|~(_is-line @n_)|) @f|)|)_) ~(_bind @do-for-each-word-in &" f doc"(|~"traversal:in when do"(|@doc &" n"(|~(_is-word @n_)|) @f|)|)_) ~(_bind @do-for-each-letter-in &" f doc"(|~"traversal:in when do"(|@doc &" n"(|~(_is-letter @n_)|) @f|)|)_) ~(_bind @do-for-each-letter-or-separator-in &" f doc"(|~"traversal:in when do"(|@doc &" n"(|~(|or ~(_is-letter @n_) ~(_is-separator @n_)|)|) @f|)|)_) ~(_bind @top-mask-nex-by &" n amount"(|~(_let @nexheight ~(_get-pixel-height @n_)_) ~(_let @nexwidth ~(_get-pixel-width @n_)_) ~(_let @maskheight ~(_::ti:: @amount @nexheight_)_) ~(_cons @n ~(_style:clip-contents ~"style:set-width-for to"(_~"style:set-height-for to"(_[word](__) @maskheight_) @nexwidth_)_)_)|)_)|)