!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OSC=e()}(this,(function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function e(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=a(t);if(e){var o=a(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function l(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}function h(){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=l(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function p(t){return Number(t)===t&&t%1==0}function d(t){return Number(t)===t}function v(t){return"string"==typeof t}function w(t){return"boolean"==typeof t}function y(t){return t===1/0}function g(t){return"[object Array]"===Object.prototype.toString.call(t)}function k(t){return"[object Object]"===Object.prototype.toString.call(t)}function b(t){return"function"==typeof t}function m(t){return t instanceof Uint8Array}function S(t){return t instanceof Date}function O(t){return void 0===t}function E(t){return null===t}function C(t){return t+3&-4}function P(t){return Object.prototype.hasOwnProperty.call("undefined"!=typeof global?global:window,t)}function A(t){return t.buffer?new DataView(t.buffer):t instanceof ArrayBuffer?new DataView(t):new DataView(new Uint8Array(t))}function I(t){if(p(t))return"i";if(e=t,Number(e)===e&&e%1!=0)return"f";if(v(t))return"s";if(m(t))return"b";if(w(t))return t?"T":"F";if(E(t))return"N";if(y(t))return"I";var e;throw new Error("OSC typeTag() found unknown value type")}function D(t){var e="";if(g(t))return"/".concat(t.join("/"));if(v(t))return(e=t).length>1&&"/"===e[e.length-1]&&(e=e.slice(0,e.length-1)),e.length>1&&"/"!==e[0]&&(e="/".concat(e)),e;throw new Error("OSC prepareAddress() needs addresses of type array or string")}function j(t){if(!v(t))throw new Error("OSC prepareRegExPattern() needs strings");return t.replace(/\./g,"\\.").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\{/g,"(").replace(/\}/g,")").replace(/,/g,"|").replace(/\[!/g,"[^").replace(/\?/g,".").replace(/\*/g,".*")}var x=function(){function t(){n(this,t),this.data=[],this.byteLength=0}return o(t,[{key:"add",value:function(t){if(w(t)||y(t)||E(t))return this;var e=t.pack();return this.byteLength+=e.byteLength,this.data.push(e),this}},{key:"merge",value:function(){var t=new Uint8Array(this.byteLength),e=0;return this.data.forEach((function(n){t.set(n,e),e+=n.byteLength})),t}}]),t}(),B=function(){function t(e){n(this,t),this.value=e,this.offset=0}return o(t,[{key:"pack",value:function(t,e){if(!t||!e)throw new Error("OSC Atomic cant't be packed without given method or byteLength");var n=new Uint8Array(e),r=new DataView(n.buffer);if(O(this.value))throw new Error("OSC Atomic cant't be encoded with empty value");return r[t](this.offset,this.value,!1),n}},{key:"unpack",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(t&&e&&n))throw new Error("OSC Atomic cant't be unpacked without given dataView, method or byteLength");if(!(t instanceof DataView))throw new Error("OSC Atomic expects an instance of type DataView");return this.value=t[e](r,!1),this.offset=r+n,this.offset}}]),t}(),H=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&!p(t))throw new Error("OSC AtomicInt32 constructor expects value of type number");return e.call(this,t)}return o(r,[{key:"pack",value:function(){return h(a(r.prototype),"pack",this).call(this,"setInt32",4)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h(a(r.prototype),"unpack",this).call(this,t,"getInt32",4,e)}}]),r}(B),T="utf-8";function L(t){if(P("Buffer"))return Buffer.from(t).toString(T);if(P("TextDecoder"))return new TextDecoder(T).decode(new Int8Array(t));for(var e="",n=0;n<t.length;n+=65537)e+=String.fromCharCode.apply(null,t.slice(n,n+65537));return e}var _=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&!v(t))throw new Error("OSC AtomicString constructor expects value of type string");return e.call(this,t)}return o(r,[{key:"pack",value:function(){if(O(this.value))throw new Error("OSC AtomicString can not be encoded with empty value");for(var t="".concat(this.value,"\0"),e=C(t.length),n=new Uint8Array(e),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC AtomicString expects an instance of type DataView");for(var n,r=e,o=[];r<t.byteLength;r+=1){if(0===(n=t.getUint8(r))){r+=1;break}o.push(n)}if(r===t.length)throw new Error("OSC AtomicString found a malformed OSC string");return this.offset=C(r),this.value=L(o),this.offset}}]),r}(B),M=2208988800,N=4294967296,V=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(n(this,t),!p(e)||!p(r))throw new Error("OSC Timetag constructor expects values of type integer number");this.seconds=e,this.fractions=r}return o(t,[{key:"timestamp",value:function(t){var e;if("number"==typeof t){e=t/1e3;var n=Math.floor(e);return this.seconds=n+M,this.fractions=Math.round(N*(e-n)),t}return 1e3*((e=this.seconds-M)+Math.round(this.fractions/N))}}]),t}(),U=function(t){s(r,t);var e=f(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();n(this,r);var o=new V;return t instanceof V?o=t:p(t)?o.timestamp(t):S(t)&&o.timestamp(t.getTime()),e.call(this,o)}return o(r,[{key:"pack",value:function(){if(O(this.value))throw new Error("OSC AtomicTimetag can not be encoded with empty value");var t=this.value,e=t.seconds,n=t.fractions,r=new Uint8Array(8),o=new DataView(r.buffer);return o.setInt32(0,e,!1),o.setInt32(4,n,!1),r}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC AtomicTimetag expects an instance of type DataView");var n=t.getUint32(e,!1),r=t.getUint32(e+4,!1);return this.value=new V(n,r),this.offset=e+8,this.offset}}]),r}(B),R=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&!m(t))throw new Error("OSC AtomicBlob constructor expects value of type Uint8Array");return e.call(this,t)}return o(r,[{key:"pack",value:function(){if(O(this.value))throw new Error("OSC AtomicBlob can not be encoded with empty value");var t=C(this.value.byteLength),e=new Uint8Array(t+4);return new DataView(e.buffer).setInt32(0,this.value.byteLength,!1),e.set(this.value,4),e}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC AtomicBlob expects an instance of type DataView");var n=t.getInt32(e,!1);return this.value=new Uint8Array(t.buffer,e+4,n),this.offset=C(e+4+n),this.offset}}]),r}(B),F=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&!d(t))throw new Error("OSC AtomicFloat32 constructor expects value of type float");return e.call(this,t)}return o(r,[{key:"pack",value:function(){return h(a(r.prototype),"pack",this).call(this,"setFloat32",4)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h(a(r.prototype),"unpack",this).call(this,t,"getFloat32",4,e)}}]),r}(B),W=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&!d(t))throw new Error("OSC AtomicFloat64 constructor expects value of type float");return e.call(this,t)}return o(r,[{key:"pack",value:function(){return h(a(r.prototype),"pack",this).call(this,"setFloat64",8)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h(a(r.prototype),"unpack",this).call(this,t,"getFloat64",8,e)}}]),r}(B),q=BigInt("9223372036854775807"),z=BigInt("-9223372036854775808"),G=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&"bigint"!=typeof t)throw new Error("OSC AtomicInt64 constructor expects value of type BigInt");if(t&&(t<z||t>q))throw new Error("OSC AtomicInt64 value is out of bounds");var o;return t&&(o=BigInt.asIntN(64,t)),e.call(this,o)}return o(r,[{key:"pack",value:function(){return h(a(r.prototype),"pack",this).call(this,"setBigInt64",8)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h(a(r.prototype),"unpack",this).call(this,t,"getBigInt64",8,e)}}]),r}(B),Z=BigInt("18446744073709551615"),J=function(t){s(r,t);var e=f(r);function r(t){if(n(this,r),t&&"bigint"!=typeof t)throw new Error("OSC AtomicUInt64 constructor expects value of type BigInt");if(t&&(t<0||t>Z))throw new Error("OSC AtomicUInt64 value is out of bounds");var o;return t&&(o=BigInt.asUintN(64,t)),e.call(this,o)}return o(r,[{key:"pack",value:function(){return h(a(r.prototype),"pack",this).call(this,"setBigUint64",8)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h(a(r.prototype),"unpack",this).call(this,t,"getBigUint64",8,e)}}]),r}(B),K=!0,Q=!1,X=null,Y=1/0,$=function(){function t(e,r){var o=this;if(n(this,t),this.offset=0,this.address="",this.types="",this.args=[],!O(e)){if(!v(e)&&!g(e))throw new Error("OSC Message constructor first argument (address) must be a string or array");this.address=D(e)}if(!O(r)){if(!g(r))throw new Error("OSC Message constructor second argument (args) must be an array");r.forEach((function(t){return o.add(t.type,t.value)}))}}return o(t,[{key:"add",value:function(t,e){if(O(t))throw new Error("OSC Message needs a valid OSC Atomic Data Type");"N"===t?this.args.push(X):"T"===t?this.args.push(K):"F"===t?this.args.push(Q):"I"===t?this.args.push(Y):this.args.push(e),this.types+=t}},{key:"pack",value:function(){var t=this;if(0===this.address.length||"/"!==this.address[0])throw new Error("OSC Message has an invalid address");var e=new x;if(e.add(new _(this.address)),e.add(new _(",".concat(this.types))),this.args.length>0){var n;if(this.args.length>this.types.length)throw new Error("OSC Message argument and type tag mismatch");this.args.forEach((function(r,o){var i=t.types[o];if("i"===i)n=new H(r);else if("h"===i)n=new G(r);else if("t"===i)n=new J(r);else if("f"===i)n=new F(r);else if("d"===i)n=new W(r);else if("s"===i)n=new _(r);else if("b"===i)n=new R(r);else if("T"===i)n=K;else if("F"===i)n=Q;else if("N"===i)n=X;else{if("I"!==i)throw new Error("OSC Message found unknown argument type");n=Y}e.add(n)}))}return e.merge()}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Message expects an instance of type DataView.");var n=new _;n.unpack(t,e);var r=new _;if(r.unpack(t,n.offset),0===n.value.length||"/"!==n.value[0])throw new Error("OSC Message found malformed or missing address string");if(0===r.value.length&&","!==r.value[0])throw new Error("OSC Message found malformed or missing type string");for(var o,i,s=r.offset,a=[],u=1;u<r.value.length;u+=1){if(o=null,"i"===(i=r.value[u]))o=new H;else if("h"===i)o=new G;else if("t"===i)o=new J;else if("f"===i)o=new F;else if("d"===i)o=new W;else if("s"===i)o=new _;else if("b"===i)o=new R;else if("T"===i)a.push(K);else if("F"===i)a.push(Q);else if("N"===i)a.push(X);else{if("I"!==i)throw new Error("OSC Message found unsupported argument type");a.push(Y)}o&&(s=o.unpack(t,s),a.push(o.value))}return this.offset=s,this.address=n.value,this.types=r.value,this.args=a,this.offset}}]),t}(),tt=function(t){s(r,t);var e=f(r);function r(){var t,o,i;n(this,r);for(var s=arguments.length,a=new Array(s),u=0;u<s;u++)a[u]=arguments[u];return a.length>0&&(o=a.shift()),a.length>0&&a[0]instanceof Array&&(i=a.shift()),t=e.call(this,o,i),a.length>0&&(t.types=a.map((function(t){return I(t)})).join(""),t.args=a),t}return o(r,[{key:"add",value:function(t){h(a(r.prototype),"add",this).call(this,I(t),t)}}]),r}($),et="#bundle",nt=function(){function t(){var e=this;n(this,t),this.offset=0,this.timetag=new U,this.bundleElements=[];for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];o.length>0&&(o[0]instanceof Date||p(o[0])?this.timetag=new U(o[0]):g(o[0])?(o[0].forEach((function(t){e.add(t)})),o.length>1&&(o[1]instanceof Date||p(o[0]))&&(this.timetag=new U(o[1]))):o.forEach((function(t){e.add(t)})))}return o(t,[{key:"timestamp",value:function(t){if(!p(t))throw new Error("OSC Bundle needs an integer for setting the timestamp");this.timetag=new U(t)}},{key:"add",value:function(e){if(!(e instanceof tt||e instanceof t))throw new Error("OSC Bundle contains only Messages and Bundles");this.bundleElements.push(e)}},{key:"pack",value:function(){var t=new x;return t.add(new _(et)),this.timetag||(this.timetag=new U),t.add(this.timetag),this.bundleElements.forEach((function(e){t.add(new H(e.pack().byteLength)),t.add(e)})),t.merge()}},{key:"unpack",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC Bundle expects an instance of type DataView");var r=new _;if(r.unpack(e,n),r.value!==et)throw new Error("OSC Bundle does not contain a valid #bundle head");var o=new U,i=o.unpack(e,r.offset);for(this.bundleElements=[];i<e.byteLength;){var s=new _,a=new H;i=a.unpack(e,i);var u=void 0;s.unpack(e,i),i=(u=s.value===et?new t:new tt).unpack(e,i),this.bundleElements.push(u)}return this.offset=i,this.timetag=o,this.offset}}]),t}(),rt=function(){function t(e){if(n(this,t),e&&!(e instanceof tt||e instanceof nt))throw new Error("OSC Packet value has to be Message or Bundle");this.value=e,this.offset=0}return o(t,[{key:"pack",value:function(){if(!this.value)throw new Error("OSC Packet can not be encoded with empty body");return this.value.pack()}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Packet expects an instance of type DataView");if(t.byteLength%4!=0)throw new Error("OSC Packet byteLength has to be a multiple of four");var n,r=new _;return r.unpack(t,e),(n=r.value===et?new nt:new tt).unpack(t,e),this.offset=n.offset,this.value=n,this.offset}}]),t}(),ot={discardLateMessages:!1},it=function(){function t(r){n(this,t),this.options=e(e({},ot),r),this.addressHandlers=[],this.eventHandlers={open:[],error:[],close:[]},this.uuid=0}return o(t,[{key:"dispatch",value:function(t,e){var n=this;if(!(t instanceof rt))throw new Error("OSC EventHander dispatch() accepts only arguments of type Packet");if(!t.value)throw new Error("OSC EventHander dispatch() can't read empty Packets");if(t.value instanceof nt){var r=t.value;return r.bundleElements.forEach((function(t){if(t instanceof nt){if(r.timetag.value.timestamp()<t.timetag.value.timestamp())throw new Error("OSC Bundle timestamp is older than the timestamp of enclosed Bundles");return n.dispatch(t)}if(t instanceof tt){var o=t;return n.notify(o.address,o,r.timetag.value.timestamp(),e)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")}))}if(t.value instanceof tt){var o=t.value;return this.notify(o.address,o,0,e)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")}},{key:"call",value:function(t,e,n){var r=!1;if(v(t)&&t in this.eventHandlers)return this.eventHandlers[t].forEach((function(t){t.callback(e,n),r=!0})),r;var o=Object.keys(this.addressHandlers),i=this.addressHandlers;return o.forEach((function(o){var s=!1,a=new RegExp(j(D(t)),"g");if(a.test(o)&&o.length===a.lastIndex&&(s=!0),!s){var u=new RegExp(j(D(o)),"g");u.test(t)&&t.length===u.lastIndex&&(s=!0)}s&&i[o].forEach((function(t){t.callback(e,n),r=!0}))})),r}},{key:"notify",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(0===e.length)throw new Error("OSC EventHandler can not be called without any argument");if(e[0]instanceof rt)return this.dispatch(e[0],e[1]);if(e[0]instanceof nt||e[0]instanceof tt)return this.dispatch(new rt(e[0]),e[1]);if(!v(e[0])){var r=new rt;return r.unpack(A(e[0])),this.dispatch(r,e[1])}var o=e[0],i=null;e.length>1&&(i=e[1]);var s=null;if(e.length>2)if(p(e[2]))s=e[2];else{if(!(e[2]instanceof Date))throw new Error("OSC EventHandler timestamp has to be a number or Date");s=e[2].getTime()}var a=null;if(e.length>=3&&(a=e[3]),s){var u=Date.now();if(u>s&&!this.options.discardLateMessages)return this.call(o,i,a);var c=this;return setTimeout((function(){c.call(o,i,a)}),s-u),!0}return this.call(o,i,a)}},{key:"on",value:function(t,e){if(!v(t)&&!g(t))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!b(e))throw new Error("OSC EventHandler callback has to be a function");this.uuid+=1;var n={id:this.uuid,callback:e};if(v(t)&&t in this.eventHandlers)return this.eventHandlers[t].push(n),this.uuid;var r=D(t);return r in this.addressHandlers||(this.addressHandlers[r]=[]),this.addressHandlers[r].push(n),this.uuid}},{key:"off",value:function(t,e){if(!v(t)&&!g(t))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!p(e))throw new Error("OSC EventHandler subscription id has to be a number");var n,r;return v(t)&&t in this.eventHandlers?(n=t,r=this.eventHandlers):(n=D(t),r=this.addressHandlers),n in r&&r[n].some((function(t,o){return t.id===e&&(r[n].splice(o,1),!0)}))}}]),t}(),st="undefined"!=typeof __dirname?require("dgram"):void 0,at=-1,ut=0,ct=1,ft=2,lt=3,ht={type:"udp4",open:{host:"localhost",port:41234,exclusive:!1},send:{host:"localhost",port:41235}};function pt(t,n){return e(e(e(e({},ht),t),n),{},{open:e(e(e({},ht.open),t.open),n.open),send:e(e(e({},ht.send),t.send),n.send)})}var dt=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n(this,t),!st)throw new Error("DatagramPlugin can not be used in browser context");this.options=pt({},r),this.socket=st.createSocket(this.options.type),this.socketStatus=at,this.socket.on("message",(function(t,n){e.notify(t,n)})),this.socket.on("error",(function(t){e.notify("error",t)})),this.notify=function(){}}return o(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e(e({},this.options.open),n),o=r.port,i=r.exclusive;this.socketStatus=ut,this.socket.bind({address:r.host,port:o,exclusive:i},(function(){t.socketStatus=ct,t.notify("open")}))}},{key:"close",value:function(){var t=this;this.socketStatus=ft,this.socket.close((function(){t.socketStatus=lt,t.notify("close")}))}},{key:"send",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e(e({},this.options.send),n),o=r.port,i=r.host;this.socket.send(Buffer.from(t),0,t.byteLength,o,i)}}]),t}(),vt="undefined"!=typeof __dirname?require("dgram"):void 0,wt="undefined"!=typeof __dirname?require("isomorphic-ws").Server:void 0,yt=-1,gt=0,kt=1,bt=2,mt=3,St={udpServer:{host:"localhost",port:41234,exclusive:!1},udpClient:{host:"localhost",port:41235},wsServer:{host:"localhost",port:8080},receiver:"ws"};function Ot(t,n){return e(e(e(e({},St),t),n),{},{udpServer:e(e(e({},St.udpServer),t.udpServer),n.udpServer),udpClient:e(e(e({},St.udpClient),t.udpClient),n.udpClient),wsServer:e(e(e({},St.wsServer),t.wsServer),n.wsServer)})}var Et=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n(this,t),!vt||!wt)throw new Error("BridgePlugin can not be used in browser context");this.options=Ot({},r),this.websocket=null,this.socket=vt.createSocket("udp4"),this.socketStatus=yt,this.socket.on("message",(function(t){e.send(t,{receiver:"ws"}),e.notify(t.buffer)})),this.socket.on("error",(function(t){e.notify("error",t)})),this.notify=function(){}}return o(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Ot(this.options,e);this.socketStatus=gt,this.socket.bind({address:n.udpServer.host,port:n.udpServer.port,exclusive:n.udpServer.exclusive},(function(){var e={};n.wsServer.server?e.server=n.wsServer.server:e=n.wsServer,t.websocket=new wt(e),t.websocket.binaryType="arraybuffer",t.websocket.on("listening",(function(){t.socketStatus=kt,t.notify("open")})),t.websocket.on("error",(function(e){t.notify("error",e)})),t.websocket.on("connection",(function(e){e.on("message",(function(e,n){t.send(e,{receiver:"udp"}),t.notify(new Uint8Array(e),n)}))}))}))}},{key:"close",value:function(){var t=this;this.socketStatus=bt,this.socket.close((function(){t.websocket.close((function(){t.socketStatus=mt,t.notify("close")}))}))}},{key:"send",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Ot(this.options,e),r=n.receiver;if("udp"===r){var o=t instanceof Buffer?t:Buffer.from(t);this.socket.send(o,0,o.byteLength,n.udpClient.port,n.udpClient.host)}else{if("ws"!==r)throw new Error("BridgePlugin can not send message to unknown receiver");this.websocket.clients.forEach((function(e){e.send(t,{binary:!0})}))}}}]),t}(),Ct="undefined"==typeof global?window:global,Pt="undefined"==typeof __dirname?Ct.WebSocket:require("isomorphic-ws"),At=-1,It=0,Dt=1,jt=2,xt=3,Bt={host:"localhost",port:8080,secure:!1,protocol:[]},Ht=function(){function t(r){if(n(this,t),!Pt)throw new Error("WebsocketClientPlugin can't find a WebSocket class");this.options=e(e({},Bt),r),this.socket=null,this.socketStatus=At,this.notify=function(){}}return o(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e(e({},this.options),n),o=r.port,i=r.host,s=r.secure,a=r.protocol;this.socket&&this.close();var u=s?"wss":"ws",c={address:i,family:u,port:o,size:0};this.socket=new Pt("".concat(u,"://").concat(i,":").concat(o),a),this.socket.binaryType="arraybuffer",this.socketStatus=It,this.socket.onopen=function(){t.socketStatus=Dt,t.notify("open")},this.socket.onclose=function(){t.socketStatus=xt,t.notify("close")},this.socket.onerror=function(e){t.notify("error",e)},this.socket.onmessage=function(e){t.notify(e.data,c)}}},{key:"close",value:function(){this.socketStatus=jt,this.socket.close()}},{key:"send",value:function(t){this.socket.send(t)}}]),t}(),Tt="undefined"!=typeof __dirname?require("isomorphic-ws").Server:void 0,Lt=-1,_t=0,Mt=1,Nt=2,Vt=3,Ut={host:"localhost",port:8080},Rt=function(){function t(r){if(n(this,t),!Tt)throw new Error("WebsocketServerPlugin can not be used in browser context");this.options=e(e({},Ut),r),this.socket=null,this.socketStatus=Lt,this.notify=function(){}}return o(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e(e({},this.options),n),o=r.port,i=r.host,s={address:i,family:"wsserver",port:o,size:0};this.socket&&this.close(),r.server?this.socket=new Tt({server:r.server}):this.socket=new Tt({host:i,port:o}),this.socket.binaryType="arraybuffer",this.socketStatus=_t,this.socket.on("listening",(function(){t.socketStatus=Mt,t.notify("open")})),this.socket.on("error",(function(e){t.notify("error",e)})),this.socket.on("connection",(function(e){e.on("message",(function(e){t.notify(new Uint8Array(e),s)}))}))}},{key:"close",value:function(){var t=this;this.socketStatus=Nt,this.socket.close((function(){t.socketStatus=Vt,t.notify("close")}))}},{key:"send",value:function(t){this.socket.clients.forEach((function(e){e.send(t,{binary:!0})}))}}]),t}(),Ft={discardLateMessages:!1,plugin:new Ht},Wt=function(){function t(r){if(n(this,t),r&&!k(r))throw new Error("OSC options argument has to be an object.");this.options=e(e({},Ft),r),this.eventHandler=new it({discardLateMessages:this.options.discardLateMessages});var o=this.eventHandler;this.options.plugin&&this.options.plugin.registerNotify&&this.options.plugin.registerNotify((function(){return o.notify.apply(o,arguments)}))}return o(t,[{key:"on",value:function(t,e){if(!v(t)||!b(e))throw new Error("OSC on() needs event- or address string and callback function");return this.eventHandler.on(t,e)}},{key:"off",value:function(t,e){if(!v(t)||!p(e))throw new Error("OSC off() needs string and number (subscriptionId) to unsubscribe");return this.eventHandler.off(t,e)}},{key:"open",value:function(t){if(t&&!k(t))throw new Error("OSC open() options argument needs to be an object");if(!this.options.plugin||!b(this.options.plugin.open))throw new Error("OSC Plugin API #open is not implemented!");return this.options.plugin.open(t)}},{key:"status",value:function(){if(!this.options.plugin||!b(this.options.plugin.status))throw new Error("OSC Plugin API #status is not implemented!");return this.options.plugin.status()}},{key:"close",value:function(){if(!this.options.plugin||!b(this.options.plugin.close))throw new Error("OSC Plugin API #close is not implemented!");return this.options.plugin.close()}},{key:"send",value:function(t,e){if(!this.options.plugin||!b(this.options.plugin.send))throw new Error("OSC Plugin API #send is not implemented!");if(!(t instanceof $||t instanceof tt||t instanceof nt||t instanceof rt))throw new Error("OSC send() needs Messages, Bundles or Packets");if(e&&!k(e))throw new Error("OSC send() options argument has to be an object");return this.options.plugin.send(t.pack(),e)}}]),t}();return Wt.STATUS={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},Wt.Packet=rt,Wt.Bundle=nt,Wt.Message=tt,Wt.TypedMessage=$,Wt.DatagramPlugin=dt,Wt.WebsocketClientPlugin=Ht,Wt.WebsocketServerPlugin=Rt,Wt.BridgePlugin=Et,Wt}));
//# sourceMappingURL=osc.min.js.map
